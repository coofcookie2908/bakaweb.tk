
Array.prototype.contains=function(a){for(i=0;i<this.length;i++){if(this[i]==a){return true}}return false};function checkLibraries(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){console.log("Knihovny v prohlížeči jsou v pořádku...")}else{alert("The File APIs are not fully supported in this browser.")}if(typeof(Storage)!=="undefined"){}else{alert("Web storage is not supported in this browser. Progress won't be saved.")}}function Question(c,b,a){this.question=(c==undefined?"":c);this.answer=(b==undefined?"":b.toUpperCase());this.image=(a==undefined?"":a);this.answers=this.answer.split("##")}function Test(){this.topic="";this.description="";this.questions=[];this.partialQuestions=[];this.selected=-1;this.wrong=0;this.right=0;this.onStatChange=function(){};this.addQuestion=function(a){this.questions.push(a)};this.generateXML=function(){this.removeEmptyQuestions();xml='<?xml version="1.0" encoding="UTF-8"?>\n<test>\n\t<nadpis>'+this.topic+"</nadpis>\n\t<popis>"+this.description+"</popis>\n";for(var a=0;a<test.questions.length;a++){xml=xml+'\t<otazka otazka="'+test.questions[a].question+'" odpoved="'+test.questions[a].answer+'" uri_obrazku="'+test.questions[a].image+'" />\n'}xml=xml+"</test>";return xml};this.fillPartialQuestions=function(){this.partialQuestions=this.questions.slice(0)};this.selectQuestion=function(){if(this.partialQuestions.length==0){this.fillPartialQuestions()}this.selected=Math.floor(Math.random()*(this.partialQuestions.length-1));console.log(this.selected);this.onStatChange()};this.checkAnswer=function(a){if(this.partialQuestions[this.selected].answers.contains(a.toUpperCase())){this.right++;this.partialQuestions.splice(this.selected,1)}else{alert('Špatně - "'+this.partialQuestions[this.selected].answer+'"');this.wrong++}};this.answerCurrent=function(a){this.checkAnswer(a);this.selectQuestion()};this.loadXML=function(a){var e=new DOMParser();var d=e.parseFromString(a,"text/xml");this.topic=d.getElementsByTagName("nadpis")[0].innerHTML;this.description=d.getElementsByTagName("popis")[0].innerHTML;var c=d.getElementsByTagName("otazka");for(var b=0;b<c.length;b++){this.addQuestion(new Question(c[b].getAttribute("otazka"),c[b].getAttribute("odpoved"),c[b].getAttribute("uri_obrazku")))}this.selectQuestion()};this.save=function(){if(typeof(Storage)!=="undefined"){localStorage.setItem("lastTest",JSON.stringify(this));console.log("saved")}};this.removeEmptyQuestions=function(){for(var a=test.questions.length-1;a>-1;a--){if(test.questions[a].image==""&&test.questions[a].question==""&&test.questions[a].answer==""){test.questions.splice(a,1)}}};this.load=function(){if(typeof(Storage)!=="undefined"){var a=JSON.parse(localStorage.getItem("lastTest"));this.selected=a.selected;this.topic=a.topic;this.description=a.description;this.questions=a.questions;this.partialQuestions=a.partialQuestions;this.wrong=a.wrong;this.right=a.right}}};